<h2>Bulk Edit</h2>

<div class="alert alert-info" *ngIf="loading">Loading...</div>

<div *ngIf="implementationGuide" class="bulk-edit">
  <ul ngbNav #nav="ngbNav" class="nav-tabs" (navChange)="changeTab($event.nextId)">
    <li ngbNavItem="profiles">
      <a ngbNavLink>Profiles</a>
      <ng-template ngbNavContent>
        <div class="row">
          <div class="col-md-3">
            <input type="text" class="form-control" placeholder="Search profiles..." [(ngModel)]="searchProfileText" />
          </div>
        </div>

        <div class="btn-toolbar mb-2">
          <div class="btn-group" aria-label="Profile Fields">
            <input type="checkbox" class="btn-check" id="btnProfileDescription" [(ngModel)]="enabledFields.profileDescription" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnProfileDescription">Description</label>
          </div>
        </div>

        <div class="card" *ngFor="let profile of filteredProfiles; let pIndex = index;">
          <div class="card-header">
            Profile {{profile.name}}{{changedProfiles[profile.id] === true ? '*' : ''}}
          </div>
          <div class="card-body">
            <div class="mb-3" *ngIf="enabledFields.profileDescription">
              <label>Description</label>
              <pre *ngIf="!editFields[profile.id + 'description']" (click)="editFields[profile.id + 'description'] = true">{{profile.description}}</pre>
              <trifolia-fhir-markdown [(value)]="profile.description" *ngIf="editFields[profile.id + 'description']" (valueChange)="changedProfiles[profile.id] = true"></trifolia-fhir-markdown>
            </div>
          </div>
        </div>
      </ng-template>
    </li>

    <li ngbNavItem="elements">
      <a ngbNavLink>Elements</a>
      <ng-template ngbNavContent>
        <div class="row">
          <div class="col-md-3">
            <input type="text" class="form-control" placeholder="Search profiles..." [(ngModel)]="searchProfileText" />
          </div>
        </div>

        <div class="btn-toolbar mb-2">
          <div class="btn-group" aria-label="Element Fields">

            <input type="checkbox" [(ngModel)]="enabledFields.elementShort" class="btn-check" id="btnElementShort" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnElementShort">Short</label>

            <input type="checkbox" [(ngModel)]="enabledFields.elementDefinition" class="btn-check" id="btnElementDefinition" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnElementDefinition">Definition</label>

            <input type="checkbox" [(ngModel)]="enabledFields.elementRequirements" class="btn-check" id="btnElementRequirements" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnElementRequirements">Requirements</label>
          </div>
        </div>

        <div class="card" *ngFor="let profile of filteredProfiles; let pIndex = index;">
          <div class="card-header clickable" (click)="toggleExpandElementsProfile(profile)">
            <i class="fa" [class.fa-plus]="expandedElementsProfileId !== profile.id" [class.fa-minus]="expandedElementsProfileId === profile.id"></i>
            Profile {{profile.name}}{{changedProfiles[profile.id] === true ? '*' : ''}}
          </div>
          <div class="card-body" *ngIf="expandedElementsProfileId === profile.id">
            <div class="card" *ngFor="let element of profile.differential?.element; let eIndex = index">
              <div class="card-header">Element {{eIndex + 1}}: {{element.id}}</div>
              <div class="card-body">
                <div class="mb-3" *ngIf="enabledFields.elementShort">
                  <label>Short</label>
                  <pre *ngIf="!editFields[profile.id + element.id + 'short'] " (click)="editFields[profile.id + element.id + 'short'] = true">{{element.short}}</pre>
                  <app-fhir-string [parentObject]="element" propertyName="short" [isFormGroup]="false" *ngIf="editFields[profile.id + element.id + 'short']" (change)="changedProfiles[profile.id] = true"></app-fhir-string>
                </div>

                <div class="mb-3" *ngIf="enabledFields.elementDefinition">
                  <label>Definition</label>
                  <pre *ngIf="!editFields[profile.id + element.id + 'definition']" (click)="editFields[profile.id + element.id + 'definition'] = true">{{element.definition}}</pre>
                  <trifolia-fhir-markdown [(value)]="element.definition" *ngIf="editFields[profile.id + element.id + 'definition']" (change)="changedProfiles[profile.id] = true"></trifolia-fhir-markdown>
                </div>

                <div class="mb-3" *ngIf="enabledFields.elementRequirements">
                  <label>Requirements</label>
                  <pre *ngIf="!editFields[profile.id + element.id + 'requirements']" (click)="editFields[profile.id + element.id + 'requirements'] = true">{{element.requirements}}</pre>
                  <trifolia-fhir-markdown [(value)]="element.requirements" *ngIf="editFields[profile.id + element.id + 'requirements']" (change)="changedProfiles[profile.id] = true"></trifolia-fhir-markdown>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-template>
    </li>

    <li ngbNavItem="pages">
      <a ngbNavLink>Pages</a>
      <ng-template ngbNavContent>
        <trifolia-fhir-page-wrapper [implementationGuide]="implementationGuide" [changedPages]="changedProfiles"></trifolia-fhir-page-wrapper>
      </ng-template>
    </li>
  </ul>
  <div [ngbNavOutlet]="nav"></div>
</div>

<footer class="footer">
  <div class="btn-group">
    <button type="button" class="btn btn-primary" (click)="save()">Save</button>
  </div>
  <span class="message">{{message}}</span>
</footer>
