<div *ngIf="resource">
  <h1 *ngIf="!isExample">{{ resource.resource.resourceType || 'Unknown' }} - {{ resource.resource.id || resource.id}}</h1>
  <h1 *ngIf="isExample">{{ resource.content.resourceType || 'Unknown' }} - {{ resource.content.id || resource.id}}</h1>
  <input type="file" style="display: none;" #fileUpload accept="application/json, application/xml" (change)="uploadFile($event)"/>
  <div class="btn-toolbar">
    <div class="btn-group me-2" role="group" aria-label="Generic actions for the resource">
      <button type="button" class="btn btn-primary" title="Remove this resource" (click)="remove()">
        <i class="fa fa-trash"></i>
      </button>
      <!-- <button type="button" class="btn btn-primary" title="Change this resource's ID" (click)="changeId()">
        <i class="fa fa-id-badge"></i>
      </button> -->
    </div>
    <div class="btn-group" role="group" aria-label="Download/upload" *ngIf="resource && activeSub == 'json/xml'">
      <button type="button" class="btn btn-primary" title="Download this resource"
              (click)="downloadFile()"
              [attr.data-intro]="Globals.introText['other.resource.download']">
        <i class="fa fa-download"></i>
      </button>
      <button type="button" class="btn btn-primary" title="Upload to update/overwrite this resource"
              (click)="fileUpload.click()"
              [attr.data-intro]="Globals.introText['other.resource.upload']">
        <i class="fa fa-upload"></i>
      </button>
    </div>
    <div class="input-group" *ngIf="activeSub == 'json/xml'">
      <select class="form-select" [(ngModel)]="selected" (change)="changeType()">
        <option *ngFor="let option of options" value="{{option}}">
          {{option}}
        </option>
      </select>
    </div>
  </div>
  <ul ngbNav #nav="ngbNav" class="nav-tabs" (navChange)="changeSubTab($event)">
    <li ngbNavItem="json/xml">
      <a ngbNavLink>JSON/XML</a>
      <ng-template ngbNavContent>
        <div class="input-group">
          <textarea class="form-control other" [ngModel]="content" (keyup)="contentHasChanged($event.target.value)" #jsonXmlTextField></textarea>
        </div>
      </ng-template>
    </li>
    <li ngbNavItem="permissions" *ngIf="configService.config.enableSecurity">
      <a ngbNavLink>
        Permissions <i class="fas fa-exclamation" style="color: red" *ngIf="!canEdit(resource)" title="No write permissions for current user specified!"></i>
      </a>
      <ng-template ngbNavContent>
        <trifolia-fhir-resource-permissions [resource]="resource"></trifolia-fhir-resource-permissions>
      </ng-template>
    </li>
    <li ngbNavItem="validation">
      <a ngbNavLink>
        Validation <span *ngIf="validation && validation.messages && validation.messages.length > 0">({{validation.messages.length}})</span>
      </a>
      <ng-template ngbNavContent>
        <app-validation-results [results]="validation"></app-validation-results>
      </ng-template>
    </li>
    <!-- Version History -->
    <li ngbNavItem="history">
      <a ngbNavLink>
        <span [attr.data-intro]="Globals.introText['resource.history-tab']">History</span>
      </a>
      <ng-template ngbNavContent>
        <app-resource-history [resource]="resource" (resourceChange)="resource = $event; resource.content = $event;" *ngIf="isExample"></app-resource-history>
        <app-resource-history [resource]="resource" (resourceChange)="resource = $event; resource.resource = $event;" *ngIf="!isExample"></app-resource-history>
      </ng-template>
    </li>
  </ul>
  <div [ngbNavOutlet]="nav" class="mt-2"></div>


</div>

<footer class="footer">
  <div class="btn-group">
    <button class="btn btn-primary" (click)="save()" [disabled]="serializationError || !canEdit(resource)">Save</button>
  </div>
  <span class="message">{{message}}</span>
</footer>
