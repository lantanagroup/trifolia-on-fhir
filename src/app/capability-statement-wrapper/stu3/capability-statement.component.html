<h1>Capability Statement (STU3)</h1>

<ngb-tabset [destroyOnHide]="false">
    <ngb-tab title="General">
        <ng-template ngbTabContent>
            <div class="row">
                <div class="col-md-8">
                    <app-fhir-string [parentObject]="capabilityStatement" propertyName="url" title="URL" tooltipPath="CapabilityStatement.url"></app-fhir-string>

                    <app-fhir-string [parentObject]="capabilityStatement" propertyName="name" title="Name" (change)="nameChanged()" tooltipPath="CapabilityStatement.name"></app-fhir-string>

                    <app-fhir-string [parentObject]="capabilityStatement" propertyName="title" title="Title" (change)="nameChanged()" tooltipPath="CapabilityStatement.title"></app-fhir-string>

                    <app-fhir-string [parentObject]="capabilityStatement" propertyName="publisher" title="Publisher" tooltipPath="CapabilityStatement.publisher"></app-fhir-string>

                    <div class="card">
                        <div class="card-header">
                            Formats <app-tooltip-icon tooltipPath="CapabilityStatement.format"></app-tooltip-icon>
                            <div class="pull-right">
                                <button type="button" class="btn btn-default btn-sm" title="Add a format"
                                        (click)="capabilityStatement.format.push('')">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <table class="table table-striped">
                            <tbody>
                            <tr *ngFor="let f of capabilityStatement.format; let i = index; trackBy: globals.trackByFn">
                                <td>
                                    <input type="text" class="form-control"
                                           [(ngModel)]="capabilityStatement.format[i]"/>
                                </td>
                                <td class="actions-column-1">
                                    <div class="pull-right">
                                        <button type="button" class="btn btn-default btn-sm" title="Remove this format"
                                                (click)="capabilityStatement.format.splice(i, 1)">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <input type="checkbox" [ngModel]="capabilityStatement.hasOwnProperty('patchFormat')"
                                   (ngModelChange)="globals.toggleProperty(capabilityStatement, 'patchFormat', [''])"/>
                            <div class="pull-right">
                                <button type="button" class="btn btn-default btn-sm" title="Add a format"
                                        [disabled]="!capabilityStatement.hasOwnProperty('patchFormat')"
                                        (click)="capabilityStatement.patchFormat.push('')">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                            Patch Formats <app-tooltip-icon tooltipPath="CapabilityStatement.patchFormat"></app-tooltip-icon>
                        </div>
                        <table class="table table-striped" *ngIf="capabilityStatement.hasOwnProperty('patchFormat')">
                            <tbody>
                            <tr *ngFor="let f of capabilityStatement.patchFormat; let i = index; trackBy: globals.trackByFn">
                                <td>
                                    <input type="text" class="form-control"
                                           [(ngModel)]="capabilityStatement.patchFormat[i]"/>
                                </td>
                                <td class="actions-column-1">
                                    <div class="pull-right">
                                        <button type="button" class="btn btn-default btn-sm" title="Remove this format"
                                                (click)="capabilityStatement.patchFormat.splice(i, 1)">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <app-fhir-markdown [parentObject]="capabilityStatement" propertyName="description" title="Description" [isOptional]="true" tooltipPath="CapabilityStatement.description"></app-fhir-markdown>

                    <app-fhir-markdown [parentObject]="capabilityStatement" propertyName="purpose" title="Purpose" tooltipPath="CapabilityStatement.purpose"></app-fhir-markdown>

                    <app-fhir-markdown [parentObject]="capabilityStatement" propertyName="copyright" title="Copyright" tooltipPath="CapabilityStatement.copyright"></app-fhir-markdown>
                </div>

                <div class="col-md-4">
                    <app-fhir-date [parentObject]="capabilityStatement" propertyName="date" title="Date" [required]="false" tooltipPath="CapabilityStatement.date"></app-fhir-date>

                    <div class="form-group">
                        <label>Status <app-tooltip-icon tooltipPath="CapabilityStatement.status"></app-tooltip-icon></label>
                        <select class="form-control" [(ngModel)]="capabilityStatement.status"
                                [class.is-invalid]="!capabilityStatement.status">
                            <option value="draft">Draft</option>
                            <option value="active">Active</option>
                            <option value="retired">Retired</option>
                            <option value="unknown">Unknown</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Kind <app-tooltip-icon tooltipPath="CapabilityStatement.kind"></app-tooltip-icon></label>
                        <select class="form-control" [(ngModel)]="capabilityStatement.kind"
                                [class.is-invalid]="!capabilityStatement.kind">
                            <option value="instance">Instance</option>
                            <option value="capability">Capability</option>
                            <option value="requirements">Requirements</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Accept Unknown <app-tooltip-icon tooltipPath="CapabilityStatement.acceptUnknown"></app-tooltip-icon></label>
                        <select class="form-control" [(ngModel)]="capabilityStatement.acceptUnknown"
                                [class.is-invalid]="!capabilityStatement.acceptUnknown">
                            <option value="no">No</option>
                            <option value="extensions">Extensions</option>
                            <option value="elements">Elements</option>
                            <option value="both">Both</option>
                        </select>
                    </div>

                    <app-fhir-string [parentObject]="capabilityStatement" propertyName="fhirVersion" title="FHIR Version" [required]="true" tooltipPath="CapabilityStatement.fhirVersion"></app-fhir-string>

                    <app-fhir-string [parentObject]="capabilityStatement" propertyName="version" title="Version" [required]="true" tooltipPath="CapabilityStatement.version"></app-fhir-string>

                    <app-fhir-boolean [parentObject]="capabilityStatement" propertyName="experimental" title="Experimental" [required]="true" tooltipPath="CapabilityStatement.experimental"></app-fhir-boolean>
                </div>
            </div>
        </ng-template>
    </ngb-tab>
    <ngb-tab title="Additional">
        <ng-template ngbTabContent>

            <!-- Use Context -->
            <app-fhir-multi-use-context [parentObject]="capabilityStatement" propertyName="useContext" tooltipPath="CapabilityStatement.useContext"></app-fhir-multi-use-context>

            <app-fhir-multi-jurisdiction [parentObject]="capabilityStatement" propertyName="jurisdiction" tooltipPath="CapabilityStatement.jurisdiction"></app-fhir-multi-jurisdiction>

            <div class="card">
                <div class="card-header">
                    <input type="checkbox" [ngModel]="capabilityStatement.hasOwnProperty('implementationGuide')" (ngModelChange)="globals.toggleProperty(capabilityStatement, 'implementationGuide', [''])"/>
                    Implementation Guides <app-tooltip-icon tooltipPath="CapabilityStatement.implementationGuide"></app-tooltip-icon>
                </div>

                <table class="table table-striped" *ngIf="capabilityStatement.hasOwnProperty('implementationGuide')">
                    <thead>
                    <tr>
                        <th>URI</th>
                        <th class="actions-column-2">
                            <div class="pull-right">
                                <button type="button" class="btn btn-default" title="Add a certificate" (click)="capabilityStatement.implementationGuide.push({})">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let ig of capabilityStatement.implementationGuide; let igi = index; trackBy: globals.trackByFn">
                        <td>
                            <input type="text" class="form-control" [(ngModel)]="capabilityStatement.implementationGuide[igi]" />
                        </td>
                        <td>
                            <div class="pull-right">
                                <button type="button" class="btn btn-default" title="Select an implementation guide" (click)="selectImplementationGuide(igi)">
                                    <i class="fa fa-hand-pointer-o"></i>
                                </button>
                                <button type="button" class="btn btn-default" title="Remove this certificate" (click)="capabilityStatement.implementationGuide.splice(igi, 1)">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <th colspan="2">
                            <strong>Total: {{capabilityStatement.implementationGuide ? capabilityStatement.implementationGuide.length : 0}}</strong>
                        </th>
                    </tr>
                    </tfoot>
                </table>
            </div>

            <div class="card">
                <div class="card-header">
                    <input type="checkbox" [ngModel]="capabilityStatement.hasOwnProperty('profile')" (ngModelChange)="globals.toggleProperty(capabilityStatement, 'profile', [{ reference: '', display: '' }])"/>
                    Profiles <app-tooltip-icon tooltipPath="CapabilityStatement.profile"></app-tooltip-icon>
                </div>

                <table class="table table-striped" *ngIf="capabilityStatement.hasOwnProperty('profile')">
                    <thead>
                    <tr>
                        <th>Reference</th>
                        <th class="actions-column-1">
                            <div class="pull-right">
                                <button type="button" class="btn btn-default" title="Add a profile" (click)="capabilityStatement.profile.push({ reference: '', display: '' })">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let p of capabilityStatement.profile; let pi = index">
                        <td>
                            <app-fhir-reference [parentObject]="capabilityStatement.profile" [propertyName]="pi" [isFormGroup]="false" resourceType="StructureDefinition" [required]="true" tooltipPath="CapabilityStatement.profile"></app-fhir-reference>
                        </td>
                        <td>
                            <div class="pull-right">
                                <button type="button" class="btn btn-default" title="Remove this profile" (click)="capabilityStatement.profile.splice(pi, 1)">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <th colspan="2">
                            <strong>Total: {{capabilityStatement.profile ? capabilityStatement.profile.length : 0}}</strong>
                        </th>
                    </tr>
                    </tfoot>
                </table>
            </div>

            <div class="card">
                <div class="card-header">Software <app-tooltip-icon tooltipPath="CapabilityStatement.software"></app-tooltip-icon></div>
                <div class="card-body">...</div>
            </div>

            <div class="card">
                <div class="card-header">Implementation <app-tooltip-icon tooltipPath="CapabilityStatement.implementation"></app-tooltip-icon></div>
                <div class="card-body">...</div>
            </div>

            <div class="card">
                <div class="card-header">Instantiates <app-tooltip-icon tooltipPath="CapabilityStatement.instantiates"></app-tooltip-icon></div>
                <div class="card-body">...</div>
            </div>
        </ng-template>
    </ngb-tab>
    <ngb-tab>
        <ng-template ngbTabTitle>REST</ng-template>
        <ng-template ngbTabContent>
            <input type="checkbox" [ngModel]="capabilityStatement.hasOwnProperty('rest')" (ngModelChange)="globals.toggleProperty(capabilityStatement, 'rest', [{ mode: 'client' }])"/> This capability statement includes REST entries <app-tooltip-icon tooltipPath="CapabilityStatement.rest"></app-tooltip-icon>

            <ngb-tabset *ngIf="capabilityStatement.hasOwnProperty('rest')" justify="center" #restTabSet [destroyOnHide]="false">
                <ngb-tab *ngFor="let r of capabilityStatement.rest; let ri = index" id="rest-{{ri}}">
                    <ng-template ngbTabTitle>
                        <span>REST {{ri + 1}} </span>
                        <i class="fas fa-trash-alt" title="Remove this REST entry" (click)="globals.promptForRemove(capabilityStatement.rest, ri, 'Are you sure you want to remove this item?', $event)"></i>
                    </ng-template>
                    <ng-template ngbTabContent>
                        <app-fhir-select-single-code [parentObject]="r" propertyName="mode" title="Mode" valueSetUrl="http://hl7.org/fhir/ValueSet/restful-capability-mode" [required]="true" tooltipPath="CapabilityStatement.rest.mode"></app-fhir-select-single-code>

                        <app-fhir-markdown [parentObject]="r" propertyName="description" title="Description" tooltipPath="CapabilityStatement.description"></app-fhir-markdown>

                        <!-- Security -->
                        <div class="card">
                            <div class="card-header">
                                <input type="checkbox" [ngModel]="r.hasOwnProperty('security')" (ngModelChange)="globals.toggleProperty(r, 'security', [{}])"/>
                                Security <app-tooltip-icon tooltipPath="CapabilityStatement.rest.security"></app-tooltip-icon>
                            </div>
                            <div class="card-body" *ngIf="r.hasOwnProperty('security')">
                                <app-fhir-boolean [parentObject]="r.security" propertyName="cors" title="CORS" tooltipPath="CapabilityStatement.rest.security.cors"></app-fhir-boolean>

                                <app-fhir-string [parentObject]="r.security" propertyName="description" title="Description" tooltipPath="CapabilityStatement.rest.security.description"></app-fhir-string>

                                <div class="card">
                                    <div class="card-header">
                                        <input type="checkbox" [ngModel]="r.security.hasOwnProperty('certificate')" (ngModelChange)="globals.toggleProperty(r.security, 'certificate', [{}])"/>
                                        Certificate <app-tooltip-icon tooltipPath="CapabilityStatement.rest.security.certificate"></app-tooltip-icon>
                                    </div>
                                    <table class="table table-striped" *ngIf="r.security.hasOwnProperty('certificate')">
                                        <thead>
                                        <tr>
                                            <th>Type <app-tooltip-icon tooltipPath="CapabilityStatement.rest.security.certificate.type"></app-tooltip-icon></th>
                                            <th>Blob <app-tooltip-icon tooltipPath="CapabilityStatement.rest.security.certificate.blob"></app-tooltip-icon></th>
                                            <th>
                                                <div class="pull-right">
                                                    <button type="button" class="btn btn-default" title="Add a certificate" (click)="r.security.certificate.push({})">
                                                        <i class="fa fa-plus"></i>
                                                    </button>
                                                </div>
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr *ngFor="let c of r.security.certificate; let ci = index">
                                            <td>
                                                <app-fhir-string [parentObject]="c" propertyName="type" [isFormGroup]="false"></app-fhir-string>
                                            </td>
                                            <td>
                                                <app-fhir-string [parentObject]="c" propertyName="blob" [isFormGroup]="false"></app-fhir-string>
                                            </td>
                                            <td>
                                                <div class="pull-right">
                                                    <button type="button" class="btn btn-default" title="Remove this certificate" (click)="r.security.certificate.splice(ci, 1)">
                                                        <i class="fas fa-trash-alt"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <p>
                                    Service: TODO
                                </p>
                            </div>
                        </div>

                        <!-- Resources -->
                        <div class="card">
                            <div class="card-header">
                                <input type="checkbox" [ngModel]="r.hasOwnProperty('resource')" (ngModelChange)="globals.toggleProperty(r, 'resource', [{ type: 'Account' }])"/>
                                Resource(s) <app-tooltip-icon tooltipPath="CapabilityStatement.rest.resource"></app-tooltip-icon>
                            </div>
                            <table class="table table-striped" *ngIf="r.hasOwnProperty('resource')">
                                <thead>
                                <tr>
                                    <th>
                                        Type
                                        <app-tooltip-icon tooltipPath="CapabilityStatement.rest.resource.type"></app-tooltip-icon>
                                    </th>
                                    <th>
                                        Profile
                                        <app-tooltip-icon tooltipPath="CapabilityStatement.rest.resource.profile"></app-tooltip-icon>
                                    </th>
                                    <th class="actions-column-3">
                                        <div class="pull-right">
                                            <button type="button" class="btn btn-default btn-sm" title="Add a resource" (click)="r.resource.push({ type: 'Account' })">
                                                <i class="fa fa-plus"></i>
                                            </button>
                                        </div>
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr *ngFor="let res of r.resource; let resi = index">
                                    <td>
                                        <app-fhir-select-single-code [parentObject]="res" propertyName="type" [isFormGroup]="false" valueSetUrl="http://hl7.org/fhir/ValueSet/resource-types"></app-fhir-select-single-code>
                                    </td>
                                    <td>
                                        <app-fhir-reference
                                                [parentObject]="res"
                                                propertyName="profile"
                                                [isFormGroup]="false"
                                                resourceType="StructureDefinition"></app-fhir-reference>
                                    </td>
                                    <td>
                                        <div class="pull-right btn-group">
                                            <button type="button" class="btn btn-default btn-sm" title="Edit this resource" (click)="editResource(res)">
                                                <i class="fa fa-edit"></i>
                                            </button>
                                            <button type="button" class="btn btn-default btn-sm" title="Duplicate this resource" (click)="copyResource(r, res)">
                                                <i class="fa fa-copy"></i>
                                            </button>
                                            <button type="button" class="btn btn-default btn-sm" title="Remove this resource" (click)="r.resource.splice(resi, 1)">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Interactions -->
                        <div class="card">
                            <div class="card-header">
                                <input type="checkbox" [ngModel]="r.hasOwnProperty('interaction')" (ngModelChange)="globals.toggleProperty(r, 'interaction', [{ code: 'transaction' }])"/>
                                Interaction(s) <app-tooltip-icon tooltipPath="CapabilityStatement.rest.interaction"></app-tooltip-icon>
                            </div>
                            <table class="table table-striped" *ngIf="r.hasOwnProperty('interaction')">
                                <thead>
                                <tr>
                                    <th>Code <app-tooltip-icon tooltipPath="CapabilityStatement.rest.interaction.code"></app-tooltip-icon></th>
                                    <th>Documentation <app-tooltip-icon tooltipPath="CapabilityStatement.rest.interaction.documentation"></app-tooltip-icon></th>
                                    <th class="actions-column-1">
                                        <div class="pull-right">
                                            <button type="button" class="btn btn-default btn-sm" title="Add an interaction" (click)="r.resource.push({ code: 'transaction' })">
                                                <i class="fa fa-plus"></i>
                                            </button>
                                        </div>
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr *ngFor="let i of r.interaction; let ii = index">
                                    <td>
                                        <app-fhir-select-single-code [parentObject]="i" propertyName="code" [isFormGroup]="false" [required]="true" valueSetUrl="http://hl7.org/fhir/ValueSet/type-restful-interaction"></app-fhir-select-single-code>
                                    </td>
                                    <td>
                                        <app-fhir-string [parentObject]="i" propertyName="documentation" [isFormGroup]="false"></app-fhir-string>
                                    </td>
                                    <td>
                                        <div class="pull-right">
                                            <button type="button" class="btn btn-default btn-sm" title="Remove this interaction" (click)="r.interaction.splice(ii, 1)">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Search Params -->
                        <div class="card">
                            <div class="card-header">
                                <input type="checkbox" [ngModel]="r.hasOwnProperty('searchParam')" (ngModelChange)="globals.toggleProperty(r, 'searchParam', [{}])" />
                                Search Params <app-tooltip-icon tooltipPath="CapabilityStatement.rest.searchParam"></app-tooltip-icon>
                            </div>
                            <table class="table table-striped" *ngIf="r.hasOwnProperty('searchParam')">
                                <thead>
                                <tr>
                                    <th>Name <app-tooltip-icon tooltipPath="CapabilityStatement.rest.resource.searchParam.name"></app-tooltip-icon></th>
                                    <th>Definition <app-tooltip-icon tooltipPath="CapabilityStatement.rest.resource.searchParam.definition"></app-tooltip-icon></th>
                                    <th>Type <app-tooltip-icon tooltipPath="CapabilityStatement.rest.resource.searchParam.type"></app-tooltip-icon></th>
                                    <th>Documentation <app-tooltip-icon tooltipPath="CapabilityStatement.rest.resource.searchParam.documentation"></app-tooltip-icon></th>
                                    <th class="actions-column-1">
                                        <div class="pull-right">
                                            <button type="button" class="btn btn-default btn-sm" title="Add a search param" (click)="r.searchParam.push({})">
                                                <i class="fa fa-plus"></i>
                                            </button>
                                        </div>
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr *ngFor="let si of r.searchParam; let sii = index">
                                    <td>
                                        <app-fhir-string [parentObject]="si" propertyName="name" [isFormGroup]="false" [required]="true"></app-fhir-string>
                                    </td>
                                    <td>
                                        <app-fhir-string [parentObject]="si" propertyName="definition" [isFormGroup]="false"></app-fhir-string>
                                    </td>
                                    <td>
                                        <app-fhir-select-single-code [parentObject]="si" propertyName="type" [isFormGroup]="false" valueSetUrl="http://hl7.org/fhir/ValueSet/search-param-type"></app-fhir-select-single-code>
                                    </td>
                                    <td>
                                        <app-fhir-string [parentObject]="si" propertyName="documentation" [isFormGroup]="false"></app-fhir-string>
                                    </td>
                                    <td>
                                        <div class="pull-right">
                                            <button type="button" class="btn btn-default btn-sm" title="Remove this search param" (click)="r.searchParam.splice(sii, 1)">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Operations -->
                        <div class="card">
                            <div class="card-header">
                                <input type="checkbox" [ngModel]="r.hasOwnProperty('operation')" (ngModelChange)="globals.toggleProperty(r, 'operation', [{ name: '', definition: { reference: '', display: '' }}])" />
                                Operations <app-tooltip-icon tooltipPath="CapabilityStatement.rest.operation"></app-tooltip-icon>
                            </div>
                            <table class="table table-striped" *ngIf="r.hasOwnProperty('operation')">
                                <thead>
                                <tr>
                                    <th>Name <app-tooltip-icon tooltipPath="CapabilityStatement.rest.operation.name"></app-tooltip-icon></th>
                                    <th>Definition <app-tooltip-icon tooltipPath="CapabilityStatement.rest.operation.definition"></app-tooltip-icon></th>
                                    <th class="actions-column-1">
                                        <div class="pull-right">
                                            <button type="button" class="btn btn-default btn-sm" title="Add an operation" (click)="r.operation.push({ name: '', definition: { reference: '', display: '' }})">
                                                <i class="fa fa-plus"></i>
                                            </button>
                                        </div>
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr *ngFor="let si of r.operation; let sii = index">
                                    <td>
                                        <app-fhir-string [parentObject]="si" propertyName="name" [isFormGroup]="false" [required]="true"></app-fhir-string>
                                    </td>
                                    <td>
                                        <app-fhir-reference [parentObject]="si" propertyName="definition" [isFormGroup]="false" [required]="true" resourceType="OperationDefinition"></app-fhir-reference>
                                    </td>
                                    <td>
                                        <div class="pull-right">
                                            <button type="button" class="btn btn-default btn-sm" title="Remove this operation" (click)="r.operation.splice(sii, 1)">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Compartments -->
                        <div class="card">
                            <div class="card-header">
                                <input type="checkbox" [ngModel]="r.hasOwnProperty('compartment')" (ngModelChange)="globals.toggleProperty(r, 'compartment', [''])" />
                                Compartments <app-tooltip-icon tooltipPath="CapabilityStatement.rest.compartment"></app-tooltip-icon>
                            </div>
                            <table class="table table-striped" *ngIf="r.hasOwnProperty('compartment')">
                                <thead>
                                <tr>
                                    <th>Name</th>
                                    <th class="actions-column-1">
                                        <div class="pull-right">
                                            <button type="button" class="btn btn-default btn-sm" title="Add an compartment" (click)="r.compartment.push('')">
                                                <i class="fa fa-plus"></i>
                                            </button>
                                        </div>
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr *ngFor="let si of r.compartment; let sii = index; trackBy: globals.trackByFn">
                                    <td>
                                        <app-fhir-string [parentObject]="r.compartment" [propertyName]="sii" [isFormGroup]="false" [required]="true"></app-fhir-string>
                                    </td>
                                    <td>
                                        <div class="pull-right">
                                            <button type="button" class="btn btn-default btn-sm" title="Remove this compartment" (click)="r.compartment.splice(sii, 1)">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </ng-template>
                </ngb-tab>
                <ngb-tab [disabled]="true">
                    <ng-template ngbTabTitle>
                        <button type="button" class="btn btn-default" title="Add a REST entry" (click)="addRestEntry(restTabSet)">Add</button>
                    </ng-template>
                    <ng-template ngbTabContent></ng-template>
                </ngb-tab>
            </ngb-tabset>
        </ng-template>
    </ngb-tab>
    <ngb-tab>
        <ng-template ngbTabTitle>Messaging</ng-template>
        <ng-template ngbTabContent>
            <input type="checkbox" [ngModel]="capabilityStatement.hasOwnProperty('messaging')" (ngModelChange)="globals.toggleProperty(capabilityStatement, 'messaging', [{ }])"/> This capability statement includes messaging entries <app-tooltip-icon tooltipPath="CapabilityStatement.messaging"></app-tooltip-icon>

            <ngb-tabset *ngIf="capabilityStatement.hasOwnProperty('messaging')" justify="center" #messagingTabSet [destroyOnHide]="false">
                <ngb-tab *ngFor="let messaging of capabilityStatement.messaging; let mi = index" id="messaging-{{mi}}">
                    <ng-template ngbTabTitle>
                        <span>Messaging {{mi+1}} </span>
                        <i class="fas fa-trash-alt" title="Remove this messaging entry" (click)="globals.promptForRemove(capabilityStatement.messaging, mi, 'Are you sure you want to remove this item?', $event)"></i>
                    </ng-template>
                    <ng-template ngbTabContent>
                        <!-- Endpoints -->
                        <div class="card">
                            <div class="card-header">
                                <input type="checkbox" [ngModel]="messaging.hasOwnProperty('endpoint')" (ngModelChange)="globals.toggleProperty(messaging, 'endpoint', [{ protocol: messageTransportCodes[0], address: '' }])"/>
                                Endpoints <app-tooltip-icon tooltipPath="CapabilityStatement.messaging.endpoint"></app-tooltip-icon>
                            </div>
                            <table class="table table-striped" *ngIf="messaging.hasOwnProperty('endpoint')">
                                <thead>
                                <tr>
                                    <th>Protocol <app-tooltip-icon tooltipPath="CapabilityStatement.messaging.endpoint.protocol"></app-tooltip-icon></th>
                                    <th>Address <app-tooltip-icon tooltipPath="CapabilityStatement.messaging.endpoint.address"></app-tooltip-icon></th>
                                    <th class="actions-column-1">
                                        <div class="pull-right">
                                            <button type="button" class="btn btn-default btn-sm" title="Add an endpoint" (click)="messaging.endpoint.push({ protocol: messageTransportCodes[0], address: '' })">
                                                <i class="fa fa-plus"></i>
                                            </button>
                                        </div>
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr *ngFor="let endpoint of messaging.endpoint; let ei = index">
                                    <td>
                                        <select class="form-control" [ngModel]="globals.getSelectCoding(endpoint.protocol, messageTransportCodes, true, true)" (ngModelChange)="endpoint.protocol = $event">
                                            <option *ngFor="let c of messageTransportCodes" [ngValue]="c">{{c.display || c.code}}</option>
                                        </select>
                                    </td>
                                    <td>
                                        <app-fhir-string [parentObject]="endpoint" propertyName="address" [isFormGroup]="false" [required]="true"></app-fhir-string>
                                    </td>
                                    <td>
                                        <div class="pull-right btn-group">
                                            <button type="button" class="btn btn-default btn-sm" title="Remove this endpoint" (click)="messaging.endpoint.splice(ei, 1)">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" [ngModel]="messaging.hasOwnProperty('reliableCache')" (ngModelChange)="globals.toggleProperty(messaging, 'reliableCache', 1)" />
                                Reliable Cache <app-tooltip-icon tooltipPath="CapabilityStatement.messaging.reliableCache"></app-tooltip-icon>
                            </label>
                            <input type="number" class="form-control" [disabled]="!messaging.hasOwnProperty('reliableCache')" [(ngModel)]="messaging.reliableCache" />
                        </div>

                        <app-fhir-string [parentObject]="messaging" propertyName="documentation" title="Documentation" tooltipPath="CapabilityStatement.messaging.documentation"></app-fhir-string>

                        <!-- Supported Messages -->
                        <div class="card">
                            <div class="card-header">
                                <input type="checkbox" [ngModel]="messaging.hasOwnProperty('supportedMessage')" (ngModelChange)="globals.toggleProperty(messaging, 'supportedMessage', [{ mode: 'sender', definition: { reference: '', display: '' }}])" />
                                Supported Messages <app-tooltip-icon tooltipPath="CapabilityStatement.messaging.supportedMessage"></app-tooltip-icon>
                            </div>
                            <table class="table table-striped" *ngIf="messaging.hasOwnProperty('supportedMessage')">
                                <thead>
                                <tr>
                                    <th>Mode <app-tooltip-icon tooltipPath="CapabilityStatement.messaging.supportedMessage.mode"></app-tooltip-icon></th>
                                    <th>Definition <app-tooltip-icon tooltipPath="CapabilityStatement.messaging.supportedMessage.definition"></app-tooltip-icon></th>
                                    <th class="actions-column-1">
                                        <div class="pull-right">
                                            <button type="button" class="btn btn-default btn-sm" title="Add a supported message" (click)="messaging.supportedMessage.push({ mode: 'sender', definition: { reference: '', display: '' }})">
                                                <i class="fa fa-plus"></i>
                                            </button>
                                        </div>
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr *ngFor="let sm of messaging.supportedMessage; let smi = index">
                                    <td>
                                        <app-fhir-select-single-code [parentObject]="sm" propertyName="mode" [isFormGroup]="false" [required]="true" valueSetUrl="http://hl7.org/fhir/ValueSet/event-capability-mode"></app-fhir-select-single-code>
                                    </td>
                                    <td>
                                        <app-fhir-reference [parentObject]="sm" propertyName="definition" [isFormGroup]="false" [required]="true" resourceType="MessageDefinition"></app-fhir-reference>
                                    </td>
                                    <td>
                                        <div class="pull-right">
                                            <button type="button" class="btn btn-default btn-sm" title="Remove this supported message" (click)="messaging.supportedMessage.splice(smi, 1)">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Events -->
                        <div class="card">
                            <div class="card-header">
                                <input type="checkbox" [ngModel]="messaging.hasOwnProperty('event')" (ngModelChange)="globals.toggleProperty(messaging, 'event', [getDefaultMessagingEvent()])" />
                                Events <app-tooltip-icon tooltipPath="CapabilityStatement.messaging.event"></app-tooltip-icon>
                            </div>
                            <table class="table table-striped" *ngIf="messaging.hasOwnProperty('event')">
                                <thead>
                                <tr>
                                    <th>Code <app-tooltip-icon tooltipPath="CapabilityStatement.messaging.event.code"></app-tooltip-icon></th>
                                    <th>Mode <app-tooltip-icon tooltipPath="CapabilityStatement.messaging.event.mode"></app-tooltip-icon></th>
                                    <th>Focus <app-tooltip-icon tooltipPath="CapabilityStatement.messaging.event.focus"></app-tooltip-icon></th>
                                    <th>Request <app-tooltip-icon tooltipPath="CapabilityStatement.messaging.event.request"></app-tooltip-icon></th>
                                    <th>Response <app-tooltip-icon tooltipPath="CapabilityStatement.messaging.event.response"></app-tooltip-icon></th>
                                    <th class="actions-column-2">
                                        <div class="pull-right">
                                            <button type="button" class="btn btn-default btn-sm" title="Add an event" (click)="messaging.event.push(getDefaultMessagingEvent())">
                                                <i class="fa fa-plus"></i>
                                            </button>
                                        </div>
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr *ngFor="let event of messaging.event; let eventi = index">
                                    <td>
                                        <select class="form-control" [ngModel]="globals.getSelectCoding(event.code, messageEventCodes, true, true)" (ngModelChange)="event.code = $event">
                                            <option *ngFor="let c of messageEventCodes" [ngValue]="c">{{c.display || c.code}}</option>
                                        </select>
                                    </td>
                                    <td>
                                        <app-fhir-select-single-code [parentObject]="event" propertyName="mode" [isFormGroup]="false" [required]="true" valueSetUrl="http://hl7.org/fhir/ValueSet/event-capability-mode"></app-fhir-select-single-code>
                                    </td>
                                    <td>
                                        <app-fhir-select-single-code [parentObject]="event" propertyName="focus" [isFormGroup]="false" [required]="true" valueSetUrl="http://hl7.org/fhir/ValueSet/resource-types"></app-fhir-select-single-code>
                                    </td>
                                    <td>
                                        <app-fhir-reference [parentObject]="event" propertyName="request" [isFormGroup]="false" [required]="true" resourceType="StructureDefinition"></app-fhir-reference>
                                    </td>
                                    <td>
                                        <app-fhir-reference [parentObject]="event" propertyName="response" [isFormGroup]="false" [required]="true" resourceType="StructureDefinition"></app-fhir-reference>
                                    </td>
                                    <td>
                                        <div class="pull-right btn-group">
                                            <button type="button" class="btn btn-default btn-sm" title="Edit this event" (click)="editEvent(event)">
                                                <i class="fa fa-edit"></i>
                                            </button>
                                            <button type="button" class="btn btn-default btn-sm" title="Remove this event" (click)="messaging.event.splice(eventi, 1)">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </ng-template>
                </ngb-tab>
                <ngb-tab [disabled]="true">
                    <ng-template ngbTabTitle>
                        <button type="button" class="btn btn-default" title="Add a messaging entry" (click)="addMessagingEntry(messagingTabSet)">Add</button>
                    </ng-template>
                    <ng-template ngbTabContent></ng-template>
                </ngb-tab>
            </ngb-tabset>
        </ng-template>
    </ngb-tab>
    <ngb-tab title="Document">
        <ng-template ngbTabContent>
            <p>
                <input type="checkbox" [ngModel]="capabilityStatement.hasOwnProperty('document')"
                       (ngModelChange)="globals.toggleProperty(capabilityStatement, 'document', [{ mode: 'producer', profile: { reference: '', display: '' }}])"/>
                Capability statement has document(s) <app-tooltip-icon tooltipPath="CapabilityStatement.document"></app-tooltip-icon>
            </p>

            <table class="table table-striped" *ngIf="capabilityStatement.hasOwnProperty('document')">
                <thead>
                <tr>
                    <th>Mode <app-tooltip-icon tooltipPath="CapabilityStatement.document.mode"></app-tooltip-icon></th>
                    <th>Documentation <app-tooltip-icon tooltipPath="CapabilityStatement.document.documentation"></app-tooltip-icon></th>
                    <th>Profile <app-tooltip-icon tooltipPath="CapabilityStatement.document.profile"></app-tooltip-icon></th>
                    <th class="actions-column-1">
                        <div class="pull-right">
                            <button type="button" class="btn btn-default" title="Add document"
                                    (click)="capabilityStatement.document.push({ mode: 'producer', profile: { reference: '', display: '' }})">
                                <i class="fa fa-plus"></i>
                            </button>
                        </div>
                    </th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let d of capabilityStatement.document; let i = index">
                    <td>
                        <app-fhir-select-single-code [parentObject]="d" propertyName="mode" [isFormGroup]="false" [required]="true" valueSetUrl="http://hl7.org/fhir/ValueSet/document-mode"></app-fhir-select-single-code>
                    </td>
                    <td>
                        <app-fhir-string [parentObject]="d" propertyName="documentation" [required]="false" [isFormGroup]="false"></app-fhir-string>
                    </td>
                    <td>
                        <app-fhir-reference
                                [parentObject]="d"
                                propertyName="profile"
                                resourceType="StructureDefinition"
                                [isFormGroup]="false"
                                [required]="true"
                                [hideResourceType]="true"></app-fhir-reference>
                    </td>
                    <td>
                        <div class="pull-right">
                            <button type="button" class="btn btn-default" title="Remove this document"
                                    (click)="capabilityStatement.document.splice(i, 1)">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </ng-template>
    </ngb-tab>

    <!-- Validation -->
    <ngb-tab id="validation" title="Validation">
        <ng-template ngbTabContent>
            <app-validation-results [results]="validation"></app-validation-results>
        </ng-template>
    </ngb-tab>

    <!-- RAW -->
    <ngb-tab title="RAW">
        <ng-template ngbTabContent>
            <app-raw-resource [resource]="capabilityStatement"></app-raw-resource>
        </ng-template>
    </ngb-tab>
</ngb-tabset>

<footer class="footer">
    <div class="btn-group">
        <button type="button" class="btn btn-default" (click)="save()">Save</button>
        <button type="button" class="btn btn-default" (click)="revert()" *ngIf="!isNew">Revert</button>
    </div>
    <span class="message">{{message}}</span>
</footer>